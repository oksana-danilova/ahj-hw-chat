{"version":3,"file":"main.js","mappings":"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","sources":["webpack://ahj-hw-chat/./src/js/Chat.js","webpack://ahj-hw-chat/./src/js/getCreationDate.js","webpack://ahj-hw-chat/./src/js/Tooltip.js","webpack://ahj-hw-chat/./src/js/RenderModal.js","webpack://ahj-hw-chat/./src/js/app.js"],"sourcesContent":["/* eslint-disable no-console */\nimport getCreationDate from './getCreationDate';\n\nexport default class Chat {\n  constructor(container, activeUser) {\n    this.container = container;\n    this.activeUser = activeUser;\n  }\n\n  renderConnectionUser(user) {\n    const connectionContainer = document.querySelector('.connection-container');\n\n    const connectionRow = document.createElement('UL');\n    const liPreview = document.createElement('LI');\n    const connectionPreview = document.createElement('DIV');\n    const liUser = document.createElement('LI');\n    const connectionUser = document.createElement('P');\n\n    connectionRow.classList.add('connection-row');\n    connectionPreview.classList.add('connection-prewiew');\n    connectionUser.classList.add('connection-user');\n\n    if (user === this.activeUser) {\n      connectionUser.classList.add('you');\n      connectionUser.textContent = `${user} (You)`;\n\n      window.onbeforeunload = async () => {\n        const query = `subscriptions/${encodeURIComponent(this.activeUser)}`;\n        console.log(query);\n        fetch(`https://ahj-hw8-1-backend.onrender.com/${query}`, {\n          method: 'DELETE',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n      };\n    } else {\n      connectionUser.textContent = user;\n    }\n\n    connectionContainer.appendChild(connectionRow);\n    connectionRow.append(liPreview);\n    liPreview.append(connectionPreview);\n    connectionRow.append(liUser);\n    liUser.append(connectionUser);\n  }\n\n  static removeDisconnectionUser(user) {\n    const connectionUserArray = Array.from(document.querySelectorAll('.connection-user'));\n\n    const removeUser = connectionUserArray.find((item) => item.textContent === user);\n    if (removeUser) {\n      removeUser.closest('.connection-row').remove();\n    }\n  }\n\n  async renderChat() {\n    const connectionContainer = document.createElement('DIV');\n\n    const chatContainer = document.createElement('DIV');\n    const chat = document.createElement('DIV');\n    const chatSend = document.createElement('FORM');\n    const chatMessage = document.createElement('INPUT');\n\n    chatContainer.classList.add('chat-container');\n    chat.classList.add('chat');\n    chatSend.classList.add('chat-send');\n    chatMessage.classList.add('chat-message');\n\n    chatMessage.placeholder = 'Type some text';\n\n    this.container.appendChild(chatContainer);\n    chatContainer.append(chat);\n    chatSend.append(chatMessage);\n    chatContainer.append(chatSend);\n\n    connectionContainer.classList.add('connection-container');\n    this.container.appendChild(connectionContainer);\n\n    this.messaging();\n\n    const request = fetch('https://ahj-hw8-1-backend.onrender.com/index/', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n    const result = await request;\n\n    if (!result.ok) {\n      console.error('Ошибка');\n\n      return;\n    }\n\n    const json = await result.json();\n\n    if (json) {\n      json.forEach((item) => {\n        this.renderConnectionUser(item.nickname);\n      });\n    }\n\n    this.gettingUsers();\n  }\n\n  renderMessage(autor, text) {\n    const chat = document.querySelector('.chat');\n    const boxMessage = document.createElement('DIV');\n    const information = document.createElement('SPAN');\n    const message = document.createElement('P');\n\n    boxMessage.classList.add('message-container');\n    information.classList.add('message-information');\n    message.classList.add('message-text');\n\n    const dateCreate = getCreationDate();\n\n    if (autor === this.activeUser) {\n      boxMessage.classList.add('right-align');\n      information.classList.add('you-message');\n      information.textContent = `${autor} (You), ${dateCreate}`;\n      message.textContent = text;\n    } else {\n      information.textContent = `${autor}, ${dateCreate}`;\n      message.textContent = text;\n    }\n\n    chat.appendChild(boxMessage);\n    boxMessage.append(information);\n    boxMessage.append(message);\n  }\n\n  gettingUsers() {\n    const eventSource = new EventSource('https://ahj-hw8-1-backend.onrender.com/sse');\n\n    eventSource.addEventListener('open', (e) => {\n      console.log(e);\n\n      console.log('sse open');\n    });\n\n    eventSource.addEventListener('error', (e) => {\n      console.log(e);\n\n      console.log('sse error');\n    });\n\n    eventSource.addEventListener('message', (e) => {\n      console.log(e);\n      const { nickname, req } = JSON.parse(e.data);\n\n      if (req === 'add') {\n        this.renderConnectionUser(nickname);\n      }\n      if (req === 'remove') {\n        Chat.removeDisconnectionUser(nickname);\n      }\n\n      console.log('sse message');\n    });\n  }\n\n  messaging() {\n    const ws = new WebSocket('wss://ahj-hw8-1-backend.onrender.com/ws');\n\n    const chatMessage = document.querySelector('.chat-message');\n    const chatSend = document.querySelector('.chat-send');\n\n    chatSend.addEventListener('submit', (e) => {\n      e.preventDefault();\n\n      const message = {};\n\n      message.autor = this.activeUser;\n      message.text = chatMessage.value;\n\n      if (!message) return;\n      ws.send(JSON.stringify(message));\n      chatMessage.value = '';\n    });\n\n    ws.addEventListener('open', (e) => {\n      console.log(e);\n\n      console.log('ws open');\n    });\n\n    ws.addEventListener('close', (e) => {\n      console.log(e);\n\n      console.log('ws close');\n    });\n\n    ws.addEventListener('error', (e) => {\n      console.log(e);\n\n      console.log('ws error');\n    });\n\n    ws.addEventListener('message', (e) => {\n      const data = JSON.parse(e.data);\n      const { chat: messages } = data;\n      messages.forEach((message) => {\n        const { autor } = JSON.parse(message);\n        const { text } = JSON.parse(message);\n\n        this.renderMessage(autor, text);\n      });\n\n      console.log('ws message');\n    });\n  }\n}\n","export default function getCreationDate() {\n  const date = new Date();\n  let dateHours = date.getHours();\n  let dateMinutes = date.getMinutes();\n  let dateDay = date.getDate();\n  let dateMonth = date.getMonth() + 1;\n  if (dateHours < 10) {\n    dateHours = `0${dateHours}`;\n  }\n  if (dateMinutes < 10) {\n    dateMinutes = `0${dateMinutes}`;\n  }\n  if (dateDay < 10) {\n    dateDay = `0${dateDay}`;\n  }\n  if (dateMonth < 10) {\n    dateMonth = `0${dateMonth}`;\n  }\n  return `${dateHours}:${dateMinutes} ${dateDay}.${dateMonth}.${date.getFullYear()}`;\n}\n","export default class Tooltip {\n  constructor() {\n    this._tooltips = [];\n  }\n\n  showTooltip(message, element) {\n    const tooltipElement = document.createElement('DIV');\n\n    tooltipElement.classList.add('form-error');\n    tooltipElement.textContent = message;\n\n    const id = performance.now();\n\n    this._tooltips.push({\n      id,\n      element: tooltipElement,\n    });\n\n    document.body.appendChild(tooltipElement);\n\n    const { right, top } = element.getBoundingClientRect();\n\n    tooltipElement.style.left = `${right + 5}px`;\n    tooltipElement.style.top = `${top + element.offsetHeight / 2 - tooltipElement.offsetHeight / 2}px`;\n    return id;\n  }\n\n  removeTooltip(id) {\n    const tooltip = this._tooltips.find((t) => t.id === id);\n\n    if (tooltip) {\n      tooltip.element.remove();\n    }\n\n    this._tooltips = this._tooltips.filter((t) => t.id !== id);\n  }\n\n  removeAllTooltip() {\n    this._tooltips.forEach((item) => item.element.remove());\n    this._tooltips = [];\n  }\n}\n","/* eslint-disable no-console */\nimport Chat from './Chat';\nimport Tooltip from './Tooltip';\n\nexport default class RenderModal {\n  constructor(container) {\n    this.container = container;\n    this.tooltipFactory = new Tooltip();\n  }\n\n  enterUser() {\n    const modalContainer = document.createElement('DIV');\n    const titleModal = document.createElement('H1');\n    const formModal = document.createElement('FORM');\n    const inputModal = document.createElement('INPUT');\n    const buttonModal = document.createElement('BUTTON');\n\n    modalContainer.classList.add('modal-container');\n    titleModal.classList.add('modal-title');\n    formModal.classList.add('modal-form');\n    inputModal.classList.add('modal-input');\n    buttonModal.classList.add('modal-button');\n\n    formModal.setAttribute('novalidate', true);\n    inputModal.setAttribute('required', true);\n    inputModal.name = 'nickname';\n    inputModal.setCustomValidity('');\n\n    titleModal.textContent = 'Выберите псевдоним';\n    buttonModal.textContent = 'Продолжить';\n\n    this.container.appendChild(modalContainer);\n    modalContainer.append(titleModal);\n    formModal.append(inputModal);\n    formModal.append(buttonModal);\n    modalContainer.append(formModal);\n\n    let actualMessages = [];\n\n    const showTooltip = (message, el) => {\n      actualMessages.push({\n        name: el.name,\n        id: this.tooltipFactory.showTooltip(message, el),\n      });\n    };\n\n    formModal.addEventListener('submit', async (e) => {\n      e.preventDefault();\n\n      actualMessages.forEach((message) => this.tooltipFactory.removeTooltip(message.id));\n      actualMessages = [];\n\n      let request;\n      let result;\n      let json;\n\n      request = fetch('https://ahj-hw8-1-backend.onrender.com/index/', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      RenderModal.generationLoading(modalContainer);\n\n      result = await request;\n\n      if (!result.ok) {\n        console.error('Ошибка');\n\n        return;\n      }\n\n      json = await result.json();\n\n      if (json) {\n        json.forEach((item) => {\n          if (item.nickname === inputModal.value) {\n            inputModal.setCustomValidity('customError');\n          } else {\n            inputModal.setCustomValidity('');\n          }\n        });\n      }\n\n      if (formModal.checkValidity()) {\n        const nickname = inputModal.value;\n\n        const chat = new Chat(this.container, nickname);\n\n        request = fetch('https://ahj-hw8-1-backend.onrender.com/subscriptions/', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ nickname }),\n        });\n\n        result = await request;\n\n        if (!result.ok) {\n          console.error('Ошибка');\n\n          return;\n        }\n\n        json = await result.json();\n        const { status } = json;\n\n        if (status === 'OK') {\n          modalContainer.classList.add('display-none');\n          chat.renderChat();\n        }\n      } else {\n        const error = RenderModal.getError(inputModal);\n\n        if (error) {\n          showTooltip(error, inputModal);\n        }\n      }\n    });\n\n    const elementOnBlur = (e) => {\n      const el = e.target;\n\n      const error = RenderModal.getError(el);\n      if (error) {\n        showTooltip(error, el);\n      } else {\n        const currentErrorMessage = actualMessages.find((item) => item.name === el.name);\n\n        if (currentErrorMessage) {\n          this.tooltipFactory.removeTooltip(currentErrorMessage.id);\n        }\n      }\n\n      el.removeEventListener('blur', elementOnBlur);\n    };\n\n    inputModal.addEventListener('focus', () => {\n      inputModal.addEventListener('blur', elementOnBlur);\n    });\n  }\n\n  static getError(el) {\n    const spinner = document.querySelector('.loadingio-spinner-spinner-ugc4sg2wum');\n    if (spinner) {\n      spinner.remove();\n    }\n    const errors = {\n      nickname: {\n        valueMissing: 'Заполните, пожалуйста, поле \"Псевдоним\"',\n        customError: 'Этот псевдоним занят, придумайте другой',\n      },\n    };\n\n    const errorKey = Object.keys(ValidityState.prototype).find((key) => {\n      if (!el.name) return null;\n      if (key === 'valid') return null;\n\n      if (el.validity[key]) console.log(key);\n\n      return el.validity[key];\n    });\n\n    if (!errorKey) return null;\n\n    return errors[el.name][errorKey];\n  }\n\n  static generationLoading(container) {\n    if (!document.querySelector('.loadingio-spinner-spinner-tujwj150y7p')) {\n      const imageContainer = document.createElement('DIV');\n      const animation = document.createElement('DIV');\n\n      imageContainer.classList.add('loadingio-spinner-spinner-tujwj150y7p');\n      animation.classList.add('ldio-ap4vnen1k9u');\n\n      container.appendChild(imageContainer);\n      imageContainer.append(animation);\n      for (let i = 12; i !== 0; i -= 1) {\n        animation.append(document.createElement('DIV'));\n      }\n    }\n  }\n}\n","import RenderModal from './RenderModal';\n\nconst container = document.querySelector('.app-container');\nconst render = new RenderModal(container);\n\nrender.enterUser();\n"],"names":["Chat","constructor","container","activeUser","this","renderConnectionUser","user","connectionContainer","document","querySelector","connectionRow","createElement","liPreview","connectionPreview","liUser","connectionUser","classList","add","textContent","window","onbeforeunload","async","query","encodeURIComponent","console","log","fetch","method","headers","appendChild","append","removeDisconnectionUser","removeUser","Array","from","querySelectorAll","find","item","closest","remove","renderChat","chatContainer","chat","chatSend","chatMessage","placeholder","messaging","request","result","ok","error","json","forEach","nickname","gettingUsers","renderMessage","autor","text","boxMessage","information","message","dateCreate","date","Date","dateHours","getHours","dateMinutes","getMinutes","dateDay","getDate","dateMonth","getMonth","getFullYear","getCreationDate","eventSource","EventSource","addEventListener","e","req","JSON","parse","data","ws","WebSocket","preventDefault","value","send","stringify","messages","Tooltip","_tooltips","showTooltip","element","tooltipElement","id","performance","now","push","body","right","top","getBoundingClientRect","style","left","offsetHeight","removeTooltip","tooltip","t","filter","removeAllTooltip","RenderModal","tooltipFactory","enterUser","modalContainer","titleModal","formModal","inputModal","buttonModal","setAttribute","name","setCustomValidity","actualMessages","el","generationLoading","checkValidity","status","getError","elementOnBlur","target","currentErrorMessage","removeEventListener","spinner","errorKey","Object","keys","ValidityState","prototype","key","validity","valueMissing","customError","imageContainer","animation","i"],"sourceRoot":""}